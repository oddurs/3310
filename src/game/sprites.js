// Snake II sprite bitmap data
// 37 small sprites (8x8) + 6 food sprites (16x8)
// Each row is a byte (MSB = leftmost pixel)

import { FG_COLOR } from './constants.js'

// 8x8 sprites stored as arrays of 8 bytes per sprite
const SPRITES = [
  // [0] headu - head closed, moving up
  [0x00,0x00,0x3C,0x3C,0x3C,0x3C,0xCC,0xCC],
  // [1] headd - head closed, moving down
  [0xCC,0xCC,0x3C,0x3C,0x3C,0x3C,0x00,0x00],
  // [2] headl - head closed, moving left
  [0x03,0x03,0x3C,0x3C,0x3F,0x3F,0x00,0x00],
  // [3] headr - head closed, moving right
  [0xC0,0xC0,0x3C,0x3C,0xFC,0xFC,0x00,0x00],
  // [4] headopenu - head open, moving up
  [0x00,0x00,0xC3,0xC3,0x3C,0x3C,0xCC,0xCC],
  // [5] headopend - head open, moving down
  [0xCC,0xCC,0x3C,0x3C,0xC3,0xC3,0x00,0x00],
  // [6] headopenl - head open, moving left
  [0x33,0x33,0x0C,0x0C,0x0F,0x0F,0x30,0x30],
  // [7] headopenr - head open, moving right
  [0xCC,0xCC,0x30,0x30,0xF0,0xF0,0x0C,0x0C],
  // [8] bodyu - body, moving up
  [0x3C,0x3C,0x0C,0x0C,0x30,0x30,0x3C,0x3C],
  // [9] bodyd - body, moving down
  [0x3C,0x3C,0x30,0x30,0x0C,0x0C,0x3C,0x3C],
  // [10] bodyl - body, moving left
  [0x00,0x00,0xCF,0xCF,0xF3,0xF3,0x00,0x00],
  // [11] bodyr - body, moving right
  [0x00,0x00,0xF3,0xF3,0xCF,0xCF,0x00,0x00],
  // [12] bodyfullu - body full, moving up
  [0x3C,0x3C,0xCF,0xCF,0xF3,0xF3,0x3C,0x3C],
  // [13] bodyfulld - body full, moving down
  [0x3C,0x3C,0xF3,0xF3,0xCF,0xCF,0x3C,0x3C],
  // [14] bodyfulll - body full, moving left
  [0x3C,0x3C,0xCF,0xCF,0xF3,0xF3,0x3C,0x3C],
  // [15] bodyfullr - body full, moving right
  [0x3C,0x3C,0xF3,0xF3,0xCF,0xCF,0x3C,0x3C],
  // Turn sprites: [prevDir→newDir] needs tail-side (opposite prevDir) + head-side (newDir)
  // turn0=RIGHT+BOTTOM(┘) turn1=LEFT+BOTTOM(└) turn2=TOP+LEFT(┐) turn3=TOP+RIGHT(┌)
  // [16] UP→LEFT: tail=BOTTOM, head=LEFT → turn1 (LEFT+BOTTOM)
  [0x00,0x00,0xF0,0xF0,0xCC,0xCC,0x3C,0x3C],
  // [17] UP→RIGHT: tail=BOTTOM, head=RIGHT → turn0 (RIGHT+BOTTOM)
  [0x00,0x00,0x0F,0x0F,0x33,0x33,0x3C,0x3C],
  // [18] DOWN→LEFT: tail=TOP, head=LEFT → turn2 (TOP+LEFT)
  [0x3C,0x3C,0xCC,0xCC,0xF0,0xF0,0x00,0x00],
  // [19] DOWN→RIGHT: tail=TOP, head=RIGHT → turn3 (TOP+RIGHT)
  [0x3C,0x3C,0x33,0x33,0x0F,0x0F,0x00,0x00],
  // [20] LEFT→UP: tail=RIGHT, head=TOP → turn3 (TOP+RIGHT)
  [0x3C,0x3C,0x33,0x33,0x0F,0x0F,0x00,0x00],
  // [21] LEFT→DOWN: tail=RIGHT, head=BOTTOM → turn0 (RIGHT+BOTTOM)
  [0x00,0x00,0x0F,0x0F,0x33,0x33,0x3C,0x3C],
  // [22] RIGHT→UP: tail=LEFT, head=TOP → turn2 (TOP+LEFT)
  [0x3C,0x3C,0xCC,0xCC,0xF0,0xF0,0x00,0x00],
  // [23] RIGHT→DOWN: tail=LEFT, head=BOTTOM → turn1 (LEFT+BOTTOM)
  [0x00,0x00,0xF0,0xF0,0xCC,0xCC,0x3C,0x3C],
  // Turnfull sprites (same geometry, thicker connection at the "full" end)
  // [24] UP→LEFT: turnfull1 (LEFT+BOTTOM)
  [0x00,0x00,0xF0,0xF0,0xCC,0xCC,0xFC,0xFC],
  // [25] UP→RIGHT: turnfull0 (RIGHT+BOTTOM)
  [0x00,0x00,0x0F,0x0F,0x33,0x33,0x3F,0x3F],
  // [26] DOWN→LEFT: turnfull2 (TOP+LEFT)
  [0xFC,0xFC,0xCC,0xCC,0xF0,0xF0,0x00,0x00],
  // [27] DOWN→RIGHT: turnfull3 (TOP+RIGHT)
  [0x3F,0x3F,0x33,0x33,0x0F,0x0F,0x00,0x00],
  // [28] LEFT→UP: turnfull3 (TOP+RIGHT)
  [0x3F,0x3F,0x33,0x33,0x0F,0x0F,0x00,0x00],
  // [29] LEFT→DOWN: turnfull0 (RIGHT+BOTTOM)
  [0x00,0x00,0x0F,0x0F,0x33,0x33,0x3F,0x3F],
  // [30] RIGHT→UP: turnfull2 (TOP+LEFT)
  [0xFC,0xFC,0xCC,0xCC,0xF0,0xF0,0x00,0x00],
  // [31] RIGHT→DOWN: turnfull1 (LEFT+BOTTOM)
  [0x00,0x00,0xF0,0xF0,0xCC,0xCC,0xFC,0xFC],
  // [32] tailu - tail, body above
  [0x3C,0x3C,0x3C,0x3C,0x0C,0x0C,0x0C,0x0C],
  // [33] taild - tail, body below
  [0x0C,0x0C,0x0C,0x0C,0x3C,0x3C,0x3C,0x3C],
  // [34] taill - tail, body to left
  [0x00,0x00,0xF0,0xF0,0xFF,0xFF,0x00,0x00],
  // [35] tailr - tail, body to right
  [0x00,0x00,0x0F,0x0F,0xFF,0xFF,0x00,0x00],
  // [36] nibble
  [0x30,0x30,0xCC,0xCC,0x30,0x30,0x00,0x00],
]

// 16x8 food sprites stored as arrays of 8 uint16 values (MSB = leftmost pixel)
const FOOD_SPRITES = [
  // [0] food0 - apple
  [0x0F00,0x0F00,0x33CC,0x33CC,0xFFFC,0xFFFC,0x0FF0,0x0FF0],
  // [1] food1 - drink
  [0x0FF0,0x0FF0,0xFFFF,0xFFFF,0xCFF3,0xCFF3,0xCC33,0xCC33],
  // [2] food2 - flower
  [0x3330,0x3330,0xCFFC,0xCFFC,0xFFFF,0xFFFF,0x0C30,0x0C30],
  // [3] food3 - comb
  [0x0000,0x0000,0xC000,0xC000,0xFFFF,0xFFFF,0x3333,0x3333],
  // [4] food4 - boot
  [0xF030,0xF030,0xF0FC,0xF0FC,0x0FFF,0x0FFF,0x00CC,0x00CC],
  // [5] food5 - ice cream
  [0x00F0,0x00F0,0xC3CC,0xC3CC,0xCFFC,0xCFFC,0x3FFF,0x3FFF],
]

// Draw an 8x8 sprite at pixel position (px, py) on context
export function drawSprite(ctx, index, px, py) {
  const data = SPRITES[index]
  if (!data) return
  for (let row = 0; row < 8; row++) {
    const byte = data[row]
    for (let col = 0; col < 8; col++) {
      if (byte & (0x80 >> col)) {
        ctx.fillRect(px + col, py + row, 1, 1)
      }
    }
  }
}

// Draw a 16x8 food sprite at pixel position (px, py) on context
export function drawFoodSprite(ctx, index, px, py) {
  const data = FOOD_SPRITES[index]
  if (!data) return
  for (let row = 0; row < 8; row++) {
    const word = data[row]
    for (let col = 0; col < 16; col++) {
      if (word & (0x8000 >> col)) {
        ctx.fillRect(px + col, py + row, 1, 1)
      }
    }
  }
}

// Turn sprite offset lookup: TURN_INDEX[prevDir][newDir]
// DIR_UP=0, DIR_DOWN=1, DIR_LEFT=2, DIR_RIGHT=3
// Returns offset 0-7 to add to SPR_TURN base, or -1 if invalid
export const TURN_INDEX = [
  // prevDir=UP:    can turn to LEFT(0) or RIGHT(1)
  [-1, -1, 0, 1],
  // prevDir=DOWN:  can turn to LEFT(2) or RIGHT(3)
  [-1, -1, 2, 3],
  // prevDir=LEFT:  can turn to UP(4) or DOWN(5)
  [4, 5, -1, -1],
  // prevDir=RIGHT: can turn to UP(6) or DOWN(7)
  [6, 7, -1, -1],
]
